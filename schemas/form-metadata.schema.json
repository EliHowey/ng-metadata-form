{
    "$schema": "http://json-schema.org/draft-07/schema",
    "title": "Form Metadata",
    "description": "Metadata required to render an HTML form dynamically.",
    "type": "object",
    "properties": {
        "id": {
            "description": "A unique ID for the form. IDs may contain alphanumeric characters, hyphens, and/or underscores.",
            "type": "string",
            "pattern": "^[A-Za-z0-9\\-_]+$"
        },
        "contents": {
            "description": "Contents of the form. This can be a series of form questions or sections.",
            "type": "array",
            "items": {
                "type": "object",
                "$ref": "#/definitions/formContents",
                "properties": {
                    "type": {
                        "description": "Type of form contents. Forms can contain sections, questions, or controls."
                    }
                }
            },
            "minItems": 1
        }
    },
    "required": ["contents"],
    "definitions": {
        "formContents": {
            "type": "object",
            "allOf": [
                { "required": ["type"] },
                {
                    "oneOf": [
                        { "$ref": "#/definitions/formSection" },
                        { "$ref": "#/definitions/formQuestion" },
                        { "$ref": "#/definitions/formControl" }
                    ]
                }
            ]
        },
        "formSection": {
            "description": "A section of a dynamic Angular form.",
            "type": "object",
            "properties": {
                "type": { "const": "section" },
                "id": {
                    "description": "A unique ID for the form section. IDs may contain alphanumeric characters, hyphens, and/or underscores.",
                    "type": "string",
                    "pattern": "^[A-Za-z0-9\\-_]+$"
                },
                "title": {
                    "description": "Title of the form section.",
                    "type": "string"
                },
                "contents": {
                    "description": "Contents of the form section.",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/formContents",
                        "properties": {
                            "type": {
                                "description": "Type of form section contents. Form sections can contain controls, questions, or other sections.",
                                "type": "string"
                            }
                        }
                    },
                    "minItems": 1
                }
            },
            "required": ["id", "contents"]
        },
        "formQuestion": {
            "description": "A question within a dynamic Angular form.",
            "type": "object",
            "properties": {
                "type": { "const": "question" },
                "id": {
                    "description": "A unique ID for the form question. IDs may contain alphanumeric characters, hyphens, and/or underscores.",
                    "type": "string",
                    "pattern": "^[A-Za-z0-9\\-_]+$"
                },
                "questionText": {
                    "description": "Display text of the form question.",
                    "type": "string"
                },
                "helpText": {
                    "description": "Help text for the form question.",
                    "type": "string"
                },
                "controls": {
                    "description": "Form controls for the question.",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/formControl"
                    },
                    "minItems": 2
                }
            },
            "required": ["id", "questionText", "controls"]
        },
        "formControl": {
            "description": "Metadata required to render Angular form controls dynamically.",
            "type": "object",
            "properties": {
                "type": { "const": "control" },
                "id": {
                    "description": "A unique ID for the form control. IDs may contain alphanumeric characters, hyphens, and/or underscores.",
                    "type": "string",
                    "pattern": "^[A-Za-z0-9\\-_]+$"
                },
                "controlType": {
                    "description": "Type of the control.",
                    "type": "string"
                },
                "label": {
                    "description": "Label for the control.",
                    "type": "string",
                    "minLength": 1
                },
                "helpText": {
                    "description": "Help text for the control.",
                    "type": "string"
                },
                "required": {
                    "description": "Whether the user is required to provide a value in the control.",
                    "type": "boolean"
                },
                "initialValue": {
                    "description": "Initial value of the control.",
                    "type": "string"
                }
            },
            "required": ["id", "controlType", "label"],
            "oneOf": [
                { "$ref": "#/definitions/checkbox" },
                { "$ref": "#/definitions/date" },
                { "$ref": "#/definitions/email" },
                { "$ref": "#/definitions/number" },
                { "$ref": "#/definitions/phone" },
                { "$ref": "#/definitions/radio" },
                { "$ref": "#/definitions/select" },
                { "$ref": "#/definitions/text" },
                { "$ref": "#/definitions/textarea" }
            ]
        },
        "form-control-placeholder": {
            "description": "Placeholder text for the input.",
            "type": "string",
            "minLength": 1
        },
        "checkbox": {
            "description": "A checkbox input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "checkbox" },
                "checked": {
                    "description": "Whether the checkbox is checked by default.",
                    "type": "boolean"
                }
            }
        },
        "date": {
            "description": "A date input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "date" },
                "initialValue": {
                    "type": "string",
                    "examples": ["2020-11-25"]
                },
                "min": {
                    "description": "ISO date string for the earliest allowed date.",
                    "examples": ["2020-10-25"]
                },
                "max": {
                    "description": "ISO date string for the latest allowed date.",
                    "examples": ["2020-11-25"]
                }
            }
        },
        "email": {
            "description": "An email input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "email" },
                "initialValue": {
                    "examples": ["email@example.com"]
                },
                "placeholder": {
                    "$ref": "#/definitions/form-control-placeholder",
                    "examples": ["email@example.com"]
                }
            }
        },
        "number": {
            "description": "A numeric input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "number" },
                "min": {
                    "description": "Minimum value the input will accept.",
                    "type": "number"
                },
                "max": {
                    "description": "Maximum value the input will accept.",
                    "type": "number"
                },
                "step": {
                    "description": "The input will only accept values that are a multiple of this value.",
                    "type": "number"
                },
                "placeholder": { "$ref": "#/definitions/form-control-placeholder" }
            }
        },
        "phone": {
            "description": "A phone input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "phone" }
            }
        },
        "radio": {
            "description": "A radio input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "radio" },
                "value": {
                    "description": "Value of the radio option.",
                    "type": "string"
                },
                "checked": {
                    "description": "Whether the radio option is selected by default.",
                    "type": "boolean"
                }
            },
            "required": ["value"]
        },
        "select": {
            "description": "A select input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "select" },
                "options": {
                    "description": "Options available to select from the control.",
                    "type": "array",
                    "items": {
                        "oneOf": [
                            { "type": "string" },
                            { "$ref": "#/definitions/option" },
                            { "$ref": "#/definitions/optgroup" }
                        ]
                    }
                }
            }
        },
        "option": {
            "description": "An option for a select control.",
            "type": "object",
            "properties": {
                "label": {
                    "description": "Text content of the option.",
                    "type": "string"
                },
                "value": {
                    "description": "Value of the option. If omitted, `label` will be used as the value.",
                    "type": "string"
                },
                "selected": {
                    "description": "Whether the option is selected by default.",
                    "type": "boolean"
                },
                "disabled": {
                    "description": "Whether the option is disabled by default.",
                    "type": "boolean"
                }
            },
            "required": ["label"]
        },
        "optgroup": {
            "description": "A group of related options within a select control.",
            "type": "object",
            "properties": {
                "label": {
                    "description": "Text content of the option group.",
                    "type": "string"
                },
                "options": {
                    "description": "Options within the option group.",
                    "type": ["string", "object"],
                    "oneOf": [{ "type": "string" }, { "$ref": "#/definitions/option" }]
                },
                "disabled": {
                    "description": "Whether the option group is disabled.",
                    "type": "boolean"
                }
            },
            "required": ["label", "options"]
        },
        "text": {
            "description": "A basic text input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "text" },
                "placeholder": { "$ref": "#/definitions/form-control-placeholder" }
            }
        },
        "textarea": {
            "description": "A multiline text input control.",
            "type": "object",
            "properties": {
                "controlType": { "const": "textarea" },
                "cols": {
                    "description": "The visible width of the text control, in average character widths.",
                    "type": "number",
                    "minimum": 1
                },
                "rows": {
                    "description": "The number of visible text lines for the control.",
                    "type": "number",
                    "minimum": 1
                },
                "placeholder": { "$ref": "#/definitions/form-control-placeholder" }
            }
        }
    }
}
